<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FAST: simulation • ProFAST</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="FAST: simulation">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ProFAST</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CosMx.html">CoFAST: NSCLC CosMx data coembedding</a>
    </li>
    <li>
      <a href="../articles/FASTdlpfc.html">FAST: single DLPFC section</a>
    </li>
    <li>
      <a href="../articles/FASTdlpfc2.html">FAST: two DLPFC sections</a>
    </li>
    <li>
      <a href="../articles/FASTsimu.html">FAST: simulation</a>
    </li>
    <li>
      <a href="../articles/pbmc3k.html">CoFAST: PBMC scRNA-seq data coembedding</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/feiyoung/ProFAST/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>FAST: simulation</h1>
                        <h4 data-toc-skip class="author">Wei Liu</h4>
            
            <h4 data-toc-skip class="date">2025-02-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/feiyoung/ProFAST/blob/HEAD/vignettes/FASTsimu.Rmd" class="external-link"><code>vignettes/FASTsimu.Rmd</code></a></small>
      <div class="hidden name"><code>FASTsimu.Rmd</code></div>

    </div>

    
    
<p>This vignette introduces the FAST workflow for the analysis of
multiple simulated spatial transcriptomics dataset. FAST workflow is
based on the PRECASTObj object created in the <code>PRECAST</code> R
package and the workflow of FAST is similar to that of PRECAST; see (<a href="https://feiyoung.github.io/PRECAST/articles/PRECAST.BreastCancer.html" class="external-link uri">https://feiyoung.github.io/PRECAST/articles/PRECAST.BreastCancer.html</a>)
for the workflow of PRECAST. The workflow of FAST consists of three
steps</p>
<ul>
<li>Independent preprocessing and model setting</li>
<li>Spatial dimension reduction using FAST</li>
<li>Downstream analysis (i.e. , embedding alignment using Harmony and
clustering using Louvain, visualization of clusters and embeddings,
remove unwanted variation, combined differential expression
analysis)</li>
<li>Except for the above downstream analyses, cell-cell interaction
analysis and trajectory inference can also be performed on the basis of
the embeddings obtained by FAST.</li>
</ul>
<p>We demonstrate the use of FAST to three simulated ST data that are <a href="https://github.com/feiyoung/ProFAST/tree/main/vignettes_data" class="external-link">here</a>,
which can be downloaded to the current working path by the following
command:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">githubURL</span> <span class="op">&lt;-</span> <span class="st">"https://github.com/feiyoung/ProFAST/blob/main/vignettes_data/simu3.rds?raw=true"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">githubURL</span>,<span class="st">"simu3.rds"</span>,mode<span class="op">=</span><span class="st">'wb'</span><span class="op">)</span></span></code></pre></div>
<p>Then load to R</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"simu3.rds"</span><span class="op">)</span></span></code></pre></div>
<p>The package can be loaded with the command:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/feiyoung/ProFAST" class="external-link">ProFAST</a></span><span class="op">)</span> <span class="co"># load the package of FAST method</span></span>
<span><span class="co">#&gt; Loading required package: gtools</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/feiyoung/PRECAST" class="external-link">PRECAST</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: parallel</span></span>
<span><span class="co">#&gt; PRECAST :  An efficient data integration method is provided for multiple spatial transcriptomics data with non-cluster-relevant effects such as the complex batch effects. It unifies spatial factor analysis simultaneously with spatial clustering and embedding alignment, requiring only partially shared cell/domain clusters across datasets. More details can be referred to Wei Liu, et al. (2023) &lt;doi:10.1038/s41467-023-35947-w&gt;.   Check out our Package website (https://feiyoung.github.io/PRECAST/index.html) for a more complete description of the methods and analyses</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: SeuratObject</span></span>
<span><span class="co">#&gt; Loading required package: sp</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'SeuratObject'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, t</span></span></code></pre></div>
<div class="section level2">
<h2 id="view-the-simulated-data">View the simulated data<a class="anchor" aria-label="anchor" href="#view-the-simulated-data"></a>
</h2>
<p>First, we view the the three simulated spatial transcriptomics data
with ST platform. There are 200 genes for each data batch and ~2000
spots in total</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simu3</span> <span class="co">## a list including three Seurat object with default assay: RNA</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; An object of class Seurat </span></span>
<span><span class="co">#&gt; 200 features across 625 samples within 1 assay </span></span>
<span><span class="co">#&gt; Active assay: RNA (200 features, 0 variable features)</span></span>
<span><span class="co">#&gt;  2 layers present: counts, data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; An object of class Seurat </span></span>
<span><span class="co">#&gt; 200 features across 400 samples within 1 assay </span></span>
<span><span class="co">#&gt; Active assay: RNA (200 features, 0 variable features)</span></span>
<span><span class="co">#&gt;  2 layers present: counts, data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; An object of class Seurat </span></span>
<span><span class="co">#&gt; 200 features across 900 samples within 1 assay </span></span>
<span><span class="co">#&gt; Active assay: RNA (200 features, 0 variable features)</span></span>
<span><span class="co">#&gt;  2 layers present: counts, data</span></span></code></pre></div>
<p>Check the content in <code>simu3</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">simu3</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">simu3</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-a-precastobject-object">Create a PRECASTObject object<a class="anchor" aria-label="anchor" href="#create-a-precastobject-object"></a>
</h2>
<p>We show how to create a PRECASTObject object step by step. First, we
create a Seurat list object using the count matrix and meta data of each
data batch. Although <code>simu3</code> is a prepared Seurat list
object, we re-create a same objcet seuList to show the details.</p>
<ul>
<li>Note: the spatial coordinates must be contained in the meta data and
named as <code>row</code> and <code>col</code>, which benefits the
identification of spaital coordinates by FAST</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Get the gene-by-spot read count matrices</span></span>
<span><span class="va">countList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">simu3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">counts</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Check the spatial coordinates: Yes, they are named as "row" and "col"!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">simu3</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span></span>
<span><span class="co">#&gt;          orig.ident nCount_RNA nFeature_RNA row col  Group</span></span>
<span><span class="co">#&gt; spot1 SeuratProject     130934          114   1   1 Layer4</span></span>
<span><span class="co">#&gt; spot2 SeuratProject       3103          116   2   1 Layer6</span></span>
<span><span class="co">#&gt; spot3 SeuratProject       8112          110   3   1 Layer6</span></span>
<span><span class="co">#&gt; spot4 SeuratProject       2637          105   4   1 Layer6</span></span>
<span><span class="co">#&gt; spot5 SeuratProject       5664          109   5   1 Layer5</span></span>
<span><span class="co">#&gt; spot6 SeuratProject       4636          107   6   1 Layer6</span></span>
<span></span>
<span><span class="co">## Get the meta data of each spot for each data batch</span></span>
<span><span class="va">metadataList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">simu3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## ensure the row.names of metadata in metaList are the same as that of colnames count matrix in countList</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">countList</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">r</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">M</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">metadataList</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">countList</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co">## Create the Seurat list  object</span></span>
<span></span>
<span><span class="va">seuList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">r</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">M</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">seuList</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/CreateSeuratObject.html" class="external-link">CreateSeuratObject</a></span><span class="op">(</span>counts <span class="op">=</span> <span class="va">countList</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span>, meta.data<span class="op">=</span><span class="va">metadataList</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span>, project <span class="op">=</span> <span class="st">"FASTsimu"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level3">
<h3 id="prepare-the-precastobject-with-preprocessing-step-">Prepare the PRECASTObject with preprocessing step.<a class="anchor" aria-label="anchor" href="#prepare-the-precastobject-with-preprocessing-step-"></a>
</h3>
<p>Next, we use <code><a href="https://rdrr.io/pkg/PRECAST/man/CreateiDRSCObject.html" class="external-link">CreatePRECASTObject()</a></code> to create a
PRECASTObject object based on the Seurat list object
<code>seuList</code>. Users are able to see <a href="https://feiyoung.github.io/PRECAST/articles/PRECAST.BreastCancer.html" class="external-link uri">https://feiyoung.github.io/PRECAST/articles/PRECAST.BreastCancer.html</a>
for what is done in this function. Since this is a simulated dataset, we
used all the 200 genes by using a custom gene list
<code>customGenelist=custom_genelist)</code>. We observe that there are
only 197 genes passing the filtering step.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Create PRECASTObject</span></span>
<span><span class="va">custom_genelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">seuList</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2023</span><span class="op">)</span></span>
<span><span class="va">PRECASTObj</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/pkg/PRECAST/man/CreateiDRSCObject.html" class="external-link">CreatePRECASTObject</a></span><span class="op">(</span><span class="va">seuList</span>, customGenelist<span class="op">=</span><span class="va">custom_genelist</span><span class="op">)</span></span>
<span><span class="co">#&gt; Filter spots and features from Raw count data...</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 2025-02-07 21:52:28.542161 : ***** Filtering step for raw count data finished!, 0.002 mins elapsed.</span></span>
<span><span class="co">#&gt; Select the variable genes for each data batch...</span></span>
<span><span class="co">#&gt; CreatePRECASTObject: remove genes:gene90  gene144  gene170  with low count reads in seuList.</span></span>
<span><span class="co">#&gt; 2025-02-07 21:52:28.546147 : ***** Gene selection finished!, 0 mins elapsed.</span></span>
<span><span class="co">#&gt; Filter spots and features from SVGs(HVGs) count data...</span></span>
<span><span class="co">#&gt; Normalizing layer: counts</span></span>
<span><span class="co">#&gt; Normalizing layer: counts</span></span>
<span><span class="co">#&gt; Normalizing layer: counts</span></span>
<span><span class="co">#&gt; 2025-02-07 21:52:30.353291 : ***** Filtering step for count data with variable genes finished!, 0.029 mins elapsed.</span></span>
<span></span>
<span><span class="co">## User can retain the raw seuList by the following commond.</span></span>
<span><span class="co">##  PRECASTObj &lt;-  CreatePRECASTObject(seuList, customGenelist=row.names(seuList[[1]]), rawData.preserve = TRUE)</span></span>
<span><span class="co">## check the number of genes/features after filtering step</span></span>
<span><span class="va">PRECASTObj</span><span class="op">@</span><span class="va">seulist</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; An object of class Seurat </span></span>
<span><span class="co">#&gt; 197 features across 625 samples within 1 assay </span></span>
<span><span class="co">#&gt; Active assay: RNA (197 features, 0 variable features)</span></span>
<span><span class="co">#&gt;  2 layers present: counts, data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; An object of class Seurat </span></span>
<span><span class="co">#&gt; 197 features across 400 samples within 1 assay </span></span>
<span><span class="co">#&gt; Active assay: RNA (197 features, 0 variable features)</span></span>
<span><span class="co">#&gt;  2 layers present: counts, data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; An object of class Seurat </span></span>
<span><span class="co">#&gt; 197 features across 900 samples within 1 assay </span></span>
<span><span class="co">#&gt; Active assay: RNA (197 features, 0 variable features)</span></span>
<span><span class="co">#&gt;  2 layers present: counts, data</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="fit-fast-using-simulated-data">Fit FAST using simulated data<a class="anchor" aria-label="anchor" href="#fit-fast-using-simulated-data"></a>
</h2>
<div class="section level3">
<h3 id="add-the-model-setting">Add the model setting<a class="anchor" aria-label="anchor" href="#add-the-model-setting"></a>
</h3>
<p>Add adjacency matrix list and parameter setting of FAST. More model
setting parameters can be found in <code><a href="../reference/model_set_FAST.html">model_set_FAST()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## seuList is null since the default value `rawData.preserve` is FALSE.</span></span>
<span><span class="va">PRECASTObj</span><span class="op">@</span><span class="va">seuList</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span></span>
<span><span class="co">## Add adjacency matrix list for a PRECASTObj object to prepare for FAST model fitting.</span></span>
<span><span class="va">PRECASTObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PRECAST/man/AddAdjList.html" class="external-link">AddAdjList</a></span><span class="op">(</span><span class="va">PRECASTObj</span>, platform <span class="op">=</span> <span class="st">"ST"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Neighbors were identified for 625 out of 625 spots.</span></span>
<span><span class="co">#&gt; Neighbors were identified for 400 out of 400 spots.</span></span>
<span><span class="co">#&gt; Neighbors were identified for 900 out of 900 spots.</span></span>
<span></span>
<span><span class="co">## Add a model setting in advance for a PRECASTObj object: verbose =TRUE helps outputing the information in the algorithm; </span></span>
<span><span class="va">PRECASTObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AddParSettingFAST.html">AddParSettingFAST</a></span><span class="op">(</span><span class="va">PRECASTObj</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Check the parameters</span></span>
<span><span class="va">PRECASTObj</span><span class="op">@</span><span class="va">parameterList</span></span>
<span><span class="co">#&gt; $maxIter</span></span>
<span><span class="co">#&gt; [1] 30</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $seed</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $epsLogLik</span></span>
<span><span class="co">#&gt; [1] 1e-05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $verbose</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $error_heter</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Psi_diag</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fit-fast">Fit FAST<a class="anchor" aria-label="anchor" href="#fit-fast"></a>
</h3>
<p>For function <code>FAST</code>, users can specify the number of
factors <code>q</code> and the fitted model <code>fit.model</code>. The
<code>q</code> sets the number of spatial factors to be extracted, and a
lareger one means more information to be extracted but higher
computaional cost. The <code>fit.model</code> specifies the version of
FAST to be fitted. The Gaussian version (<code>gaussian</code>) models
the log-count matrices while the Poisson verion (<code>poisson</code>)
models the count matrices; default as <code>poisson</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### set q= 20 here</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2023</span><span class="op">)</span></span>
<span><span class="va">PRECASTObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FAST.html">FAST</a></span><span class="op">(</span><span class="va">PRECASTObj</span>, q<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt; ******Run the Poisson version of FAST...</span></span>
<span><span class="co">#&gt; Finish variable initialization </span></span>
<span><span class="co">#&gt; Satrt ICM step! </span></span>
<span><span class="co">#&gt; iter = 2, ELBO= 189470755.273560, dELBO=1.088229 </span></span>
<span><span class="co">#&gt; Satrt ICM step! </span></span>
<span><span class="co">#&gt; iter = 3, ELBO= 208006705.975706, dELBO=0.097830 </span></span>
<span><span class="co">#&gt; Satrt ICM step! </span></span>
<span><span class="co">#&gt; iter = 4, ELBO= 208036349.004114, dELBO=0.000143 </span></span>
<span><span class="co">#&gt; Satrt ICM step! </span></span>
<span><span class="co">#&gt; iter = 5, ELBO= 208052955.566629, dELBO=0.000080 </span></span>
<span><span class="co">#&gt; Satrt ICM step! </span></span>
<span><span class="co">#&gt; iter = 6, ELBO= 208063415.354311, dELBO=0.000050 </span></span>
<span><span class="co">#&gt; Satrt ICM step! </span></span>
<span><span class="co">#&gt; iter = 7, ELBO= 208070526.557116, dELBO=0.000034 </span></span>
<span><span class="co">#&gt; Satrt ICM step! </span></span>
<span><span class="co">#&gt; iter = 8, ELBO= 208075639.148463, dELBO=0.000025 </span></span>
<span><span class="co">#&gt; Satrt ICM step! </span></span>
<span><span class="co">#&gt; iter = 9, ELBO= 208079480.312729, dELBO=0.000018 </span></span>
<span><span class="co">#&gt; Satrt ICM step! </span></span>
<span><span class="co">#&gt; iter = 10, ELBO= 208082472.471151, dELBO=0.000014 </span></span>
<span><span class="co">#&gt; Satrt ICM step! </span></span>
<span><span class="co">#&gt; iter = 11, ELBO= 208084871.329220, dELBO=0.000012 </span></span>
<span><span class="co">#&gt; Satrt ICM step! </span></span>
<span><span class="co">#&gt; iter = 12, ELBO= 208086839.431824, dELBO=0.000009</span></span>
<span><span class="co">#&gt; 2025-02-07 21:52:32.365539 : ***** Finish FAST, 0.028 mins elapsed.</span></span>
<span><span class="co">### Check the results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">PRECASTObj</span><span class="op">@</span><span class="va">resList</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ FAST:List of 7</span></span>
<span><span class="co">#&gt;   ..$ hV      :List of 3</span></span>
<span><span class="co">#&gt;   .. ..$ : num [1:625, 1:20] 2.29 3.9 6.7 1.87 1.63 ...</span></span>
<span><span class="co">#&gt;   .. .. ..- attr(*, "scaled:center")= num [1:20] 1.1 -0.74 2.32 -0.297 0.925 ...</span></span>
<span><span class="co">#&gt;   .. ..$ : num [1:400, 1:20] 9.44 3.39 2.07 5.21 7.11 ...</span></span>
<span><span class="co">#&gt;   .. .. ..- attr(*, "scaled:center")= num [1:20] 0.011 0.621 0.675 0.806 3.815 ...</span></span>
<span><span class="co">#&gt;   .. ..$ : num [1:900, 1:20] -1.134 2.008 0.575 5.096 2.564 ...</span></span>
<span><span class="co">#&gt;   .. .. ..- attr(*, "scaled:center")= num [1:20] 3.61 -0.86 -1.32 -1.09 -2.94 ...</span></span>
<span><span class="co">#&gt;   ..$ nu      : num [1:3, 1:197] 1.027 4.189 -1.123 -0.314 -0.436 ...</span></span>
<span><span class="co">#&gt;   ..$ Psi     : num [1:20, 1:20, 1:3] 29.897 -3.545 -0.52 -2.123 0.458 ...</span></span>
<span><span class="co">#&gt;   ..$ W       : num [1:197, 1:20] -0.1561 0.0744 0.0839 0.0073 0.0336 ...</span></span>
<span><span class="co">#&gt;   ..$ Lam     : num [1:3, 1:197] 1.81 2.38 1.16 1.63 1.11 ...</span></span>
<span><span class="co">#&gt;   ..$ ELBO    : num 2.08e+08</span></span>
<span><span class="co">#&gt;   ..$ ELBO_seq: num [1:11] -2.15e+09 1.89e+08 2.08e+08 2.08e+08 2.08e+08 ...</span></span></code></pre></div>
<details><summary><strong>Run gaussian version</strong>
</summary><p>Users can also use the gaussian version by the following command:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2023</span><span class="op">)</span></span>
<span><span class="va">PRECASTObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FAST.html">FAST</a></span><span class="op">(</span><span class="va">PRECASTObj</span>, q<span class="op">=</span><span class="fl">20</span>, fit.model<span class="op">=</span><span class="st">'gaussian'</span><span class="op">)</span></span>
<span><span class="co">### Check the results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">PRECASTObj</span><span class="op">@</span><span class="va">resList</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<div class="section level3">
<h3 id="evaluate-the-adjusted-mcfaddens-pseudo-r-square">Evaluate the adjusted McFadden’s pseudo R-square<a class="anchor" aria-label="anchor" href="#evaluate-the-adjusted-mcfaddens-pseudo-r-square"></a>
</h3>
<p>Next, we investigate the performance of dimension reduction by
calculating the adjusted McFadden’s pseudo R-square for each data batch.
The simulated true labels is in the <code>meta.data</code> of each
component of <code>PRECASTObj@seulist</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Obtain the true labels</span></span>
<span><span class="va">yList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">PRECASTObj</span><span class="op">@</span><span class="va">seulist</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span></span>
<span><span class="co">### Evaluate the MacR2</span></span>
<span><span class="va">MacVec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">PRECASTObj</span><span class="op">@</span><span class="va">seulist</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="fu"><a href="../reference/get_r2_mcfadden.html">get_r2_mcfadden</a></span><span class="op">(</span><span class="va">PRECASTObj</span><span class="op">@</span><span class="va">resList</span><span class="op">$</span><span class="va">FAST</span><span class="op">$</span><span class="va">hV</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span>, <span class="va">yList</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # weights:  154 (126 variable)</span></span>
<span><span class="co">#&gt; initial  value 1216.193843 </span></span>
<span><span class="co">#&gt; iter  10 value 111.302733</span></span>
<span><span class="co">#&gt; iter  20 value 84.903136</span></span>
<span><span class="co">#&gt; iter  30 value 73.537007</span></span>
<span><span class="co">#&gt; iter  40 value 70.085431</span></span>
<span><span class="co">#&gt; iter  50 value 67.564984</span></span>
<span><span class="co">#&gt; iter  60 value 64.541681</span></span>
<span><span class="co">#&gt; iter  70 value 58.571720</span></span>
<span><span class="co">#&gt; iter  80 value 54.685023</span></span>
<span><span class="co">#&gt; iter  90 value 52.256853</span></span>
<span><span class="co">#&gt; iter 100 value 49.030507</span></span>
<span><span class="co">#&gt; final  value 49.030507 </span></span>
<span><span class="co">#&gt; stopped after 100 iterations</span></span>
<span><span class="co">#&gt; # weights:  154 (126 variable)</span></span>
<span><span class="co">#&gt; initial  value 778.364060 </span></span>
<span><span class="co">#&gt; iter  10 value 109.555576</span></span>
<span><span class="co">#&gt; iter  20 value 21.847012</span></span>
<span><span class="co">#&gt; iter  30 value 4.165319</span></span>
<span><span class="co">#&gt; iter  40 value 0.876597</span></span>
<span><span class="co">#&gt; iter  50 value 0.401735</span></span>
<span><span class="co">#&gt; iter  60 value 0.249915</span></span>
<span><span class="co">#&gt; iter  70 value 0.176244</span></span>
<span><span class="co">#&gt; iter  80 value 0.130403</span></span>
<span><span class="co">#&gt; iter  90 value 0.092360</span></span>
<span><span class="co">#&gt; iter 100 value 0.067700</span></span>
<span><span class="co">#&gt; final  value 0.067700 </span></span>
<span><span class="co">#&gt; stopped after 100 iterations</span></span>
<span><span class="co">#&gt; # weights:  154 (126 variable)</span></span>
<span><span class="co">#&gt; initial  value 1751.319134 </span></span>
<span><span class="co">#&gt; iter  10 value 136.488744</span></span>
<span><span class="co">#&gt; iter  20 value 115.404960</span></span>
<span><span class="co">#&gt; iter  30 value 106.919246</span></span>
<span><span class="co">#&gt; iter  40 value 105.864477</span></span>
<span><span class="co">#&gt; iter  50 value 104.688230</span></span>
<span><span class="co">#&gt; iter  60 value 102.005826</span></span>
<span><span class="co">#&gt; iter  70 value 99.477323</span></span>
<span><span class="co">#&gt; iter  80 value 98.324310</span></span>
<span><span class="co">#&gt; iter  90 value 98.248840</span></span>
<span><span class="co">#&gt; iter 100 value 98.226919</span></span>
<span><span class="co">#&gt; final  value 98.226919 </span></span>
<span><span class="co">#&gt; stopped after 100 iterations</span></span>
<span><span class="co">### output them</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">MacVec</span><span class="op">)</span></span>
<span><span class="co">#&gt; adjusted McFadden's R2 adjusted McFadden's R2 adjusted McFadden's R2 </span></span>
<span><span class="co">#&gt;              0.9586289              0.9986095              0.9430191</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="embedding-alignment-and-clustering-using-harmony-and-louvain">Embedding alignment and clustering using Harmony and Louvain<a class="anchor" aria-label="anchor" href="#embedding-alignment-and-clustering-using-harmony-and-louvain"></a>
</h2>
<p>Based on the embeddings from FAST, we use <code>Harmony</code> to
align the embeddings then followed by Louvain clustering to obtain the
cluster labels. In this downstream analysis, other methods for embedding
alignment and clustering can be also used. In the vignette of two
sections of DLPFC Visium data, we will show another method
(<code>iSC-MEB</code>) to jointly perform embedding alignment and
spatial clustering.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PRECASTObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunHarmonyLouvain.html">RunHarmonyLouvain</a></span><span class="op">(</span><span class="va">PRECASTObj</span>, resolution <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="co">#&gt; ******Use Harmony to remove batch in the embeddings from FAST...</span></span>
<span><span class="co">#&gt; Warning in HarmonyMatrix(matlist2mat(PRECASTObj@resList$FAST$hV), meta_data =</span></span>
<span><span class="co">#&gt; data.frame(sample = sampleID), : HarmonyMatrix is deprecated and will be</span></span>
<span><span class="co">#&gt; removed in the future from the API in the future</span></span>
<span><span class="co">#&gt; Warning: Warning: The parameters do_pca and npcs are deprecated. They will be ignored for this function call and please remove parameters do_pca and npcs and pass to harmony cell_embeddings directly.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once per session.</span></span></span>
<span><span class="co">#&gt; Transposing data matrix</span></span>
<span><span class="co">#&gt; Initializing state using k-means centroids initialization</span></span>
<span><span class="co">#&gt; Harmony 1/10</span></span>
<span><span class="co">#&gt; Harmony 2/10</span></span>
<span><span class="co">#&gt; Harmony 3/10</span></span>
<span><span class="co">#&gt; Harmony converged after 3 iterations</span></span>
<span><span class="co">#&gt; 2025-02-07 21:52:33.164611 : ***** Finish Harmony correction, 0.006 mins elapsed.</span></span>
<span><span class="co">#&gt; ******Use Louvain to cluster and determine the number of clusters...</span></span>
<span><span class="co">#&gt; Warning: Data is of class matrix. Coercing to dgCMatrix.</span></span>
<span><span class="co">#&gt; Warning: No assay specified, setting assay as RNA by default.</span></span>
<span><span class="co">#&gt; Warning: Keys should be one or more alphanumeric characters followed by an</span></span>
<span><span class="co">#&gt; underscore, setting key from PC to PC_</span></span>
<span><span class="co">#&gt; Computing nearest neighbor graph</span></span>
<span><span class="co">#&gt; Computing SNN</span></span>
<span><span class="co">#&gt; Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of nodes: 1925</span></span>
<span><span class="co">#&gt; Number of edges: 89015</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Running Louvain algorithm...</span></span>
<span><span class="co">#&gt; Maximum modularity in 10 random starts: 0.8781</span></span>
<span><span class="co">#&gt; Number of communities: 7</span></span>
<span><span class="co">#&gt; Elapsed time: 0 seconds</span></span>
<span><span class="co">#&gt; 2025-02-07 21:52:33.820952 : ***** Finsh Louvain clustering and find the optimal number of clusters, 0.011 mins elapsed.</span></span>
<span><span class="va">ARI_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">M</span>, <span class="kw">function</span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="fu">mclust</span><span class="fu">::</span><span class="fu"><a href="https://mclust-org.github.io/mclust/reference/adjustedRandIndex.html" class="external-link">adjustedRandIndex</a></span><span class="op">(</span><span class="va">PRECASTObj</span><span class="op">@</span><span class="va">resList</span><span class="op">$</span><span class="va">Louvain</span><span class="op">$</span><span class="va">cluster</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span>, <span class="va">yList</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ARI_vec</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.8004654 0.8308046 0.7792729</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="remove-unwanted-variations-in-the-log-normalized-expression-matrices">Remove unwanted variations in the log-normalized expression
matrices<a class="anchor" aria-label="anchor" href="#remove-unwanted-variations-in-the-log-normalized-expression-matrices"></a>
</h2>
<p>In the following, we remove the unwanted variations in the
log-normalized expression matrices to obtain a combined log-normalized
expression matrix in a Seurat object. In the context of the simulated
data used in this study, housekeeping genes are not present, thus, we
turn to another method to remove the unwanted variations. Specifically,
we leverage the batch effect embeddings estimated through Harmony to
capture and mitigate unwanted variations. Additionally, we utilize the
cluster labels obtained via Louvain clustering to retain the desired
biological effects.</p>
<p>The estimated embeddings of batch effects (batchEmbed) are in the
slot <code>PRECASTObj@resList$Harmony</code> and cluster labels
(cluster) are in the slot <code>PRECASTObj@resList$Louvain</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">PRECASTObj</span><span class="op">@</span><span class="va">resList</span><span class="op">$</span><span class="va">Harmony</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ harmonyembed:List of 3</span></span>
<span><span class="co">#&gt;   ..$ : num [1:625, 1:20] 2.21 4.1 6.88 2.01 2.28 ...</span></span>
<span><span class="co">#&gt;   ..$ : num [1:400, 1:20] 8.88 3.13 2.09 4.79 6.05 ...</span></span>
<span><span class="co">#&gt;   ..$ : num [1:900, 1:20] -1.434 2.682 0.977 5.69 3.147 ...</span></span>
<span><span class="co">#&gt;  $ batchEmbed  :List of 3</span></span>
<span><span class="co">#&gt;   ..$ : num [1:625, 1:20] 0.2981 -0.1293 -0.0498 -0.0803 -0.456 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ : chr [1:625] "1" "2" "3" "4" ...</span></span>
<span><span class="co">#&gt;   .. .. ..$ : NULL</span></span>
<span><span class="co">#&gt;   ..$ : num [1:400, 1:20] 0.6 0.33 0.138 0.466 1.19 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ : chr [1:400] "626" "627" "628" "629" ...</span></span>
<span><span class="co">#&gt;   .. .. ..$ : NULL</span></span>
<span><span class="co">#&gt;   ..$ : num [1:900, 1:20] 0.267 -0.475 -0.171 -0.211 -0.333 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ : chr [1:900] "1026" "1027" "1028" "1029" ...</span></span>
<span><span class="co">#&gt;   .. .. ..$ : NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">PRECASTObj</span><span class="op">@</span><span class="va">resList</span><span class="op">$</span><span class="va">Louvain</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ cluster:List of 3</span></span>
<span><span class="co">#&gt;   ..$ : Factor w/ 7 levels "0","1","2","3",..: 4 3 3 3 1 3 1 2 3 5 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "names")= chr [1:625] "spot1" "spot2" "spot3" "spot4" ...</span></span>
<span><span class="co">#&gt;   ..$ : Factor w/ 7 levels "0","1","2","3",..: 3 5 7 3 1 1 1 1 2 2 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "names")= chr [1:400] "spot626" "spot627" "spot628" "spot629" ...</span></span>
<span><span class="co">#&gt;   ..$ : Factor w/ 7 levels "0","1","2","3",..: 4 4 4 4 7 5 5 5 4 5 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "names")= chr [1:900] "spot1026" "spot1027" "spot1028" "spot1029" ...</span></span></code></pre></div>
<p>Then, we integrate the three sections by removing the unwanted
variations and setting <code>seulist_HK=NULL</code> and
<code>Method = "HarmonyLouvain"</code> in the function
<code><a href="../reference/IntegrateSRTData.html">IntegrateSRTData()</a></code>. After obtaining <code>seuInt</code>, we
will see there are three embeddings: <code>FAST</code>,
<code>harmony</code> and <code>position</code>, in the slot
<code>seuInt@reductions</code>. <code>FAST</code> are the embeddings
obtained by FAST model fitting and are uncorrected embeddings that may
includes the unwanted effects (i.e., batch effects);
<code>harmony</code>are the embeddings obtained by Harmony fitting and
are aligned embeddings; and <code>position</code> are the spatial
coordinates.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seulist_HK</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">seuInt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IntegrateSRTData.html">IntegrateSRTData</a></span><span class="op">(</span><span class="va">PRECASTObj</span>, seulist_HK<span class="op">=</span><span class="va">seulist_HK</span>, Method <span class="op">=</span> <span class="st">"HarmonyLouvain"</span>, seuList_raw<span class="op">=</span><span class="cn">NULL</span>, covariates_use<span class="op">=</span><span class="cn">NULL</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ******Perform PCA on housekeeping gene expression matrix...</span></span>
<span><span class="co">#&gt; Only use  the results in Harmony and Louvain to remove unwanted variations...</span></span>
<span><span class="co">#&gt; 2025-02-07 21:52:33.950208 : ***** Finish PCA, 0 mins elapsed.</span></span>
<span><span class="co">#&gt; ******Remove the unwanted variations in gene expressions using spatial linear regression...</span></span>
<span><span class="co">#&gt; Finish variable initialization </span></span>
<span><span class="co">#&gt; iter = 2, ELBO= -502011.519262, dELBO=0.999766 </span></span>
<span><span class="co">#&gt; iter = 3, ELBO= -440535.045321, dELBO=0.122460 </span></span>
<span><span class="co">#&gt; iter = 4, ELBO= -415206.215699, dELBO=0.057496 </span></span>
<span><span class="co">#&gt; iter = 5, ELBO= -396882.312058, dELBO=0.044132 </span></span>
<span><span class="co">#&gt; iter = 6, ELBO= -385298.102370, dELBO=0.029188 </span></span>
<span><span class="co">#&gt; iter = 7, ELBO= -377426.770479, dELBO=0.020429 </span></span>
<span><span class="co">#&gt; iter = 8, ELBO= -372383.070570, dELBO=0.013363 </span></span>
<span><span class="co">#&gt; iter = 9, ELBO= -368984.027468, dELBO=0.009128 </span></span>
<span><span class="co">#&gt; iter = 10, ELBO= -366660.717606, dELBO=0.006297 </span></span>
<span><span class="co">#&gt; iter = 11, ELBO= -364958.509766, dELBO=0.004642 </span></span>
<span><span class="co">#&gt; iter = 12, ELBO= -363657.295430, dELBO=0.003565 </span></span>
<span><span class="co">#&gt; iter = 13, ELBO= -362613.437627, dELBO=0.002870 </span></span>
<span><span class="co">#&gt; iter = 14, ELBO= -361754.501054, dELBO=0.002369 </span></span>
<span><span class="co">#&gt; iter = 15, ELBO= -361031.682288, dELBO=0.001998 </span></span>
<span><span class="co">#&gt; iter = 16, ELBO= -360415.856381, dELBO=0.001706 </span></span>
<span><span class="co">#&gt; iter = 17, ELBO= -359885.474872, dELBO=0.001472 </span></span>
<span><span class="co">#&gt; iter = 18, ELBO= -359425.581454, dELBO=0.001278 </span></span>
<span><span class="co">#&gt; iter = 19, ELBO= -359024.396234, dELBO=0.001116 </span></span>
<span><span class="co">#&gt; iter = 20, ELBO= -358672.936396, dELBO=0.000979 </span></span>
<span><span class="co">#&gt; iter = 21, ELBO= -358363.858351, dELBO=0.000862 </span></span>
<span><span class="co">#&gt; iter = 22, ELBO= -358091.250571, dELBO=0.000761 </span></span>
<span><span class="co">#&gt; iter = 23, ELBO= -357850.167674, dELBO=0.000673 </span></span>
<span><span class="co">#&gt; iter = 24, ELBO= -357636.499785, dELBO=0.000597 </span></span>
<span><span class="co">#&gt; iter = 25, ELBO= -357446.754125, dELBO=0.000531 </span></span>
<span><span class="co">#&gt; iter = 26, ELBO= -357277.968204, dELBO=0.000472 </span></span>
<span><span class="co">#&gt; iter = 27, ELBO= -357127.594463, dELBO=0.000421 </span></span>
<span><span class="co">#&gt; iter = 28, ELBO= -356993.441678, dELBO=0.000376 </span></span>
<span><span class="co">#&gt; iter = 29, ELBO= -356873.608440, dELBO=0.000336 </span></span>
<span><span class="co">#&gt; iter = 30, ELBO= -356766.443070, dELBO=0.000300</span></span>
<span><span class="co">#&gt; 2025-02-07 21:52:35.111484 : ***** Finish unwanted variation removal, 0.019 mins elapsed.</span></span>
<span><span class="co">#&gt; ******Sort the results into a Seurat object...</span></span>
<span><span class="co">#&gt; 2025-02-07 21:52:35.686779 : ***** Finish results arrangement, 0.01 mins elapsed.</span></span>
<span><span class="va">seuInt</span></span>
<span><span class="co">#&gt; An object of class Seurat </span></span>
<span><span class="co">#&gt; 197 features across 1925 samples within 1 assay </span></span>
<span><span class="co">#&gt; Active assay: RNA (197 features, 0 variable features)</span></span>
<span><span class="co">#&gt;  2 layers present: counts, data</span></span>
<span><span class="co">#&gt;  3 dimensional reductions calculated: FAST, harmony, position</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h2>
<p>First, user can choose a beautiful color schema using
<code><a href="https://rdrr.io/pkg/PRECAST/man/chooseColors.html" class="external-link">chooseColors()</a></code> in the R package <code>PRECAST</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cols_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PRECAST/man/chooseColors.html" class="external-link">chooseColors</a></span><span class="op">(</span>palettes_name <span class="op">=</span> <span class="st">"Nature 10"</span>, n_colors <span class="op">=</span> <span class="fl">7</span>, plot_colors <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="FASTsimu_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>Then, we plot the spatial scatter plot for clusters using the
function <code><a href="https://rdrr.io/pkg/PRECAST/man/SpaPlot.html" class="external-link">SpaPlot()</a></code> in the R package
<code>PRECAST</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PRECAST/man/SpaPlot.html" class="external-link">SpaPlot</a></span><span class="op">(</span><span class="va">seuInt</span>, item <span class="op">=</span> <span class="st">"cluster"</span>, batch <span class="op">=</span> <span class="cn">NULL</span>, point_size <span class="op">=</span> <span class="fl">1</span>, cols <span class="op">=</span> <span class="va">cols_cluster</span>, combine <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">p12</span></span></code></pre></div>
<p><img src="FASTsimu_files/figure-html/unnamed-chunk-18-1.png" width="768">
Users can re-plot the above figures for specific need by returning a
ggplot list object. For example, we plot the spatial heatmap using a
common legend by using the function <code><a href="https://rdrr.io/pkg/PRECAST/man/drawFigs.html" class="external-link">drawFigs()</a></code> in the R
package <code>PRECAST</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PRECAST/man/SpaPlot.html" class="external-link">SpaPlot</a></span><span class="op">(</span><span class="va">seuInt</span>, item <span class="op">=</span> <span class="st">"cluster"</span>, title_name<span class="op">=</span> <span class="st">'Section'</span>,batch <span class="op">=</span> <span class="cn">NULL</span>, point_size <span class="op">=</span> <span class="fl">1</span>, cols <span class="op">=</span> <span class="va">cols_cluster</span>, combine <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/PRECAST/man/drawFigs.html" class="external-link">drawFigs</a></span><span class="op">(</span><span class="va">pList</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>, align <span class="op">=</span> <span class="st">"hv"</span><span class="op">)</span></span></code></pre></div>
<p><img src="FASTsimu_files/figure-html/unnamed-chunk-19-1.png" width="864"></p>
<p>We use the function <code><a href="https://rdrr.io/pkg/PRECAST/man/AddUMAP.html" class="external-link">AddUMAP()</a></code> in the R package
<code>PRECAST</code> to obtain the three-dimensional components of UMAP
using the aligned embeddings in the reduction <code>harmony</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seuInt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PRECAST/man/AddUMAP.html" class="external-link">AddUMAP</a></span><span class="op">(</span><span class="va">seuInt</span>, n_comp<span class="op">=</span><span class="fl">3</span>, reduction <span class="op">=</span> <span class="st">'harmony'</span>, assay <span class="op">=</span> <span class="st">'RNA'</span><span class="op">)</span></span>
<span><span class="va">seuInt</span></span>
<span><span class="co">#&gt; An object of class Seurat </span></span>
<span><span class="co">#&gt; 197 features across 1925 samples within 1 assay </span></span>
<span><span class="co">#&gt; Active assay: RNA (197 features, 0 variable features)</span></span>
<span><span class="co">#&gt;  2 layers present: counts, data</span></span>
<span><span class="co">#&gt;  4 dimensional reductions calculated: FAST, harmony, position, UMAP3</span></span></code></pre></div>
<p>We plot the spatial tNSE RGB plot to illustrate the performance in
extracting features.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p13</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PRECAST/man/SpaPlot.html" class="external-link">SpaPlot</a></span><span class="op">(</span><span class="va">seuInt</span>, batch <span class="op">=</span> <span class="cn">NULL</span>, item <span class="op">=</span> <span class="st">"RGB_UMAP"</span>, point_size <span class="op">=</span> <span class="fl">1</span>, combine <span class="op">=</span> <span class="cn">FALSE</span>, text_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/PRECAST/man/drawFigs.html" class="external-link">drawFigs</a></span><span class="op">(</span><span class="va">p13</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>, align <span class="op">=</span> <span class="st">"hv"</span><span class="op">)</span></span></code></pre></div>
<p><img src="FASTsimu_files/figure-html/unnamed-chunk-21-1.png" width="864">
We use the function <code>AddUTSNE()</code> in the R package
<code>PRECAST</code> to obtain the two-dimensional components of UMAP
using the aligned embeddings in the reduction <code>harmony</code>, and
plot the tSNE plot based on the extracted features to check the
performance of integration.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seuInt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PRECAST/man/AddTSNE.html" class="external-link">AddTSNE</a></span><span class="op">(</span><span class="va">seuInt</span>, n_comp <span class="op">=</span> <span class="fl">2</span>, reduction <span class="op">=</span> <span class="st">'harmony'</span>, assay <span class="op">=</span> <span class="st">'RNA'</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PRECAST/man/dimPlot.html" class="external-link">dimPlot</a></span><span class="op">(</span><span class="va">seuInt</span>, item <span class="op">=</span> <span class="st">"cluster"</span>, point_size <span class="op">=</span> <span class="fl">0.5</span>, font_family <span class="op">=</span> <span class="st">"serif"</span>, cols <span class="op">=</span> <span class="va">cols_cluster</span>,</span>
<span>    border_col <span class="op">=</span> <span class="st">"gray10"</span>,  legend_pos <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span>  <span class="co"># Times New Roman</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PRECAST/man/dimPlot.html" class="external-link">dimPlot</a></span><span class="op">(</span><span class="va">seuInt</span>, item <span class="op">=</span> <span class="st">"batch"</span>, point_size <span class="op">=</span> <span class="fl">0.5</span>, font_family <span class="op">=</span> <span class="st">"serif"</span>, legend_pos <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/PRECAST/man/drawFigs.html" class="external-link">drawFigs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span>, layout.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<p><img src="FASTsimu_files/figure-html/unnamed-chunk-22-1.png" width="864"></p>
</div>
<div class="section level2">
<h2 id="combined-differential-epxression-analysis">Combined differential epxression analysis<a class="anchor" aria-label="anchor" href="#combined-differential-epxression-analysis"></a>
</h2>
<p>Finally, we condut the combined differential expression analysis
using the integrated log-normalized expression matrix saved in the
<code>seuInt</code> object. The function <code><a href="https://satijalab.org/seurat/reference/FindAllMarkers.html" class="external-link">FindAllMarkers()</a></code>
in the <code>Seurat</code> R package is ued to achieve this
analysis.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_deg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindAllMarkers.html" class="external-link">FindAllMarkers</a></span><span class="op">(</span><span class="va">seuInt</span><span class="op">)</span></span>
<span><span class="co">#&gt; Calculating cluster 1</span></span>
<span><span class="co">#&gt; Calculating cluster 2</span></span>
<span><span class="co">#&gt; Calculating cluster 3</span></span>
<span><span class="co">#&gt; Calculating cluster 4</span></span>
<span><span class="co">#&gt; Calculating cluster 5</span></span>
<span><span class="co">#&gt; Calculating cluster 6</span></span>
<span><span class="co">#&gt; Calculating cluster 7</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">dat_deg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html" class="external-link">top_n</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, wt <span class="op">=</span> <span class="va">avg_log2FC</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">top10</span></span>
<span><span class="va">seuInt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html" class="external-link">ScaleData</a></span><span class="op">(</span><span class="va">seuInt</span><span class="op">)</span></span>
<span><span class="co">#&gt; Centering and scaling data matrix</span></span></code></pre></div>
<p>Plot dot plot of normalized expressions for each spatial domain
identified by using the FAST embeddings.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col_here</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#F2E6AB"</span>, <span class="st">"#9C0141"</span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/DotPlot.html" class="external-link">DotPlot</a></span><span class="op">(</span><span class="va">seuInt</span>, features<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">top10</span><span class="op">$</span><span class="va">gene</span><span class="op">)</span>, cols<span class="op">=</span><span class="va">col_here</span>, <span class="co">#  idents = ident_here,</span></span>
<span>              col.min <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, col.max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Domain"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span>, angle <span class="op">=</span> <span class="fl">25</span>, hjust <span class="op">=</span> <span class="fl">1</span>, family<span class="op">=</span><span class="st">'serif'</span><span class="op">)</span>,</span>
<span>                                      axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span>, face<span class="op">=</span> <span class="st">"italic"</span>, family<span class="op">=</span><span class="st">'serif'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p1</span></span></code></pre></div>
<p><img src="FASTsimu_files/figure-html/unnamed-chunk-24-1.png" width="864"></p>
<details><summary><strong>Session Info</strong>
</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.4.1 (2024-06-14 ucrt)</span></span>
<span><span class="co">#&gt; Platform: x86_64-w64-mingw32/x64</span></span>
<span><span class="co">#&gt; Running under: Windows 11 x64 (build 26100)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt; [1] LC_COLLATE=Chinese (Simplified)_China.utf8 </span></span>
<span><span class="co">#&gt; [2] LC_CTYPE=Chinese (Simplified)_China.utf8   </span></span>
<span><span class="co">#&gt; [3] LC_MONETARY=Chinese (Simplified)_China.utf8</span></span>
<span><span class="co">#&gt; [4] LC_NUMERIC=C                               </span></span>
<span><span class="co">#&gt; [5] LC_TIME=Chinese (Simplified)_China.utf8    </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: Asia/Tbilisi</span></span>
<span><span class="co">#&gt; tzcode source: internal</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] parallel  stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">#&gt; [8] base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] ggplot2_3.5.1      dplyr_1.1.4        Seurat_5.1.0       SeuratObject_5.0.2</span></span>
<span><span class="co">#&gt; [5] sp_2.1-4           PRECAST_1.6.5      ProFAST_1.4        gtools_3.9.5      </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] fs_1.6.4                    matrixStats_1.4.1          </span></span>
<span><span class="co">#&gt;   [3] spatstat.sparse_3.1-0       insight_1.0.0              </span></span>
<span><span class="co">#&gt;   [5] httr_1.4.7                  RColorBrewer_1.1-3         </span></span>
<span><span class="co">#&gt;   [7] tools_4.4.1                 sctransform_0.4.1          </span></span>
<span><span class="co">#&gt;   [9] backports_1.5.0             utf8_1.2.4                 </span></span>
<span><span class="co">#&gt;  [11] R6_2.5.1                    lazyeval_0.2.2             </span></span>
<span><span class="co">#&gt;  [13] uwot_0.2.2                  withr_3.0.1                </span></span>
<span><span class="co">#&gt;  [15] prettyunits_1.2.0           gridExtra_2.3              </span></span>
<span><span class="co">#&gt;  [17] progressr_0.14.0            performance_0.12.4         </span></span>
<span><span class="co">#&gt;  [19] cli_3.6.3                   Biobase_2.64.0             </span></span>
<span><span class="co">#&gt;  [21] textshaping_0.4.0           spatstat.explore_3.3-2     </span></span>
<span><span class="co">#&gt;  [23] fastDummies_1.7.4           labeling_0.4.3             </span></span>
<span><span class="co">#&gt;  [25] sass_0.4.9                  spatstat.data_3.1-2        </span></span>
<span><span class="co">#&gt;  [27] ggridges_0.5.6              pbapply_1.7-2              </span></span>
<span><span class="co">#&gt;  [29] pkgdown_2.1.1               systemfonts_1.1.0          </span></span>
<span><span class="co">#&gt;  [31] harmony_1.2.1               scater_1.32.1              </span></span>
<span><span class="co">#&gt;  [33] parallelly_1.38.0           rstudioapi_0.16.0          </span></span>
<span><span class="co">#&gt;  [35] RSQLite_2.3.7               FNN_1.1.4.1                </span></span>
<span><span class="co">#&gt;  [37] generics_0.1.3              ica_1.0-3                  </span></span>
<span><span class="co">#&gt;  [39] spatstat.random_3.3-2       car_3.1-3                  </span></span>
<span><span class="co">#&gt;  [41] Matrix_1.7-0                ggbeeswarm_0.7.2           </span></span>
<span><span class="co">#&gt;  [43] fansi_1.0.6                 S4Vectors_0.42.1           </span></span>
<span><span class="co">#&gt;  [45] abind_1.4-8                 lifecycle_1.0.4            </span></span>
<span><span class="co">#&gt;  [47] yaml_2.3.10                 CompQuadForm_1.4.3         </span></span>
<span><span class="co">#&gt;  [49] carData_3.0-5               SummarizedExperiment_1.34.0</span></span>
<span><span class="co">#&gt;  [51] SparseArray_1.4.8           BiocFileCache_2.12.0       </span></span>
<span><span class="co">#&gt;  [53] Rtsne_0.17                  grid_4.4.1                 </span></span>
<span><span class="co">#&gt;  [55] blob_1.2.4                  promises_1.3.0             </span></span>
<span><span class="co">#&gt;  [57] crayon_1.5.3                GiRaF_1.0.1                </span></span>
<span><span class="co">#&gt;  [59] miniUI_0.1.1.1              lattice_0.22-6             </span></span>
<span><span class="co">#&gt;  [61] beachmat_2.20.0             cowplot_1.1.3              </span></span>
<span><span class="co">#&gt;  [63] KEGGREST_1.44.1             pillar_1.9.0               </span></span>
<span><span class="co">#&gt;  [65] knitr_1.48                  GenomicRanges_1.56.2       </span></span>
<span><span class="co">#&gt;  [67] future.apply_1.11.2         codetools_0.2-20           </span></span>
<span><span class="co">#&gt;  [69] leiden_0.4.3.1              glue_1.7.0                 </span></span>
<span><span class="co">#&gt;  [71] spatstat.univar_3.0-1       data.table_1.16.0          </span></span>
<span><span class="co">#&gt;  [73] vctrs_0.6.5                 png_0.1-8                  </span></span>
<span><span class="co">#&gt;  [75] spam_2.10-0                 org.Mm.eg.db_3.20.0        </span></span>
<span><span class="co">#&gt;  [77] gtable_0.3.5                cachem_1.1.0               </span></span>
<span><span class="co">#&gt;  [79] xfun_0.47                   S4Arrays_1.4.1             </span></span>
<span><span class="co">#&gt;  [81] mime_0.12                   survival_3.6-4             </span></span>
<span><span class="co">#&gt;  [83] SingleCellExperiment_1.26.0 fitdistrplus_1.2-1         </span></span>
<span><span class="co">#&gt;  [85] ROCR_1.0-11                 nlme_3.1-164               </span></span>
<span><span class="co">#&gt;  [87] bit64_4.5.2                 progress_1.2.3             </span></span>
<span><span class="co">#&gt;  [89] filelock_1.0.3              RcppAnnoy_0.0.22           </span></span>
<span><span class="co">#&gt;  [91] GenomeInfoDb_1.40.1         bslib_0.8.0                </span></span>
<span><span class="co">#&gt;  [93] irlba_2.3.5.1               vipor_0.4.7                </span></span>
<span><span class="co">#&gt;  [95] KernSmooth_2.23-24          colorspace_2.1-1           </span></span>
<span><span class="co">#&gt;  [97] BiocGenerics_0.50.0         DBI_1.2.3                  </span></span>
<span><span class="co">#&gt;  [99] nnet_7.3-19                 tidyselect_1.2.1           </span></span>
<span><span class="co">#&gt; [101] DR.SC_3.4                   bit_4.5.0                  </span></span>
<span><span class="co">#&gt; [103] compiler_4.4.1              curl_5.2.3                 </span></span>
<span><span class="co">#&gt; [105] httr2_1.0.4                 BiocNeighbors_1.22.0       </span></span>
<span><span class="co">#&gt; [107] xml2_1.3.6                  desc_1.4.3                 </span></span>
<span><span class="co">#&gt; [109] DelayedArray_0.30.1         plotly_4.10.4              </span></span>
<span><span class="co">#&gt; [111] scales_1.3.0                lmtest_0.9-40              </span></span>
<span><span class="co">#&gt; [113] rappdirs_0.3.3              stringr_1.5.1              </span></span>
<span><span class="co">#&gt; [115] digest_0.6.37               goftest_1.2-3              </span></span>
<span><span class="co">#&gt; [117] presto_1.0.0                spatstat.utils_3.1-0       </span></span>
<span><span class="co">#&gt; [119] rmarkdown_2.28              RhpcBLASctl_0.23-42        </span></span>
<span><span class="co">#&gt; [121] XVector_0.44.0              htmltools_0.5.8.1          </span></span>
<span><span class="co">#&gt; [123] pkgconfig_2.0.3             sparseMatrixStats_1.16.0   </span></span>
<span><span class="co">#&gt; [125] MatrixGenerics_1.16.0       highr_0.11                 </span></span>
<span><span class="co">#&gt; [127] dbplyr_2.5.0                fastmap_1.2.0              </span></span>
<span><span class="co">#&gt; [129] rlang_1.1.4                 htmlwidgets_1.6.4          </span></span>
<span><span class="co">#&gt; [131] ggthemes_5.1.0              UCSC.utils_1.0.0           </span></span>
<span><span class="co">#&gt; [133] shiny_1.9.1                 DelayedMatrixStats_1.26.0  </span></span>
<span><span class="co">#&gt; [135] farver_2.1.2                jquerylib_0.1.4            </span></span>
<span><span class="co">#&gt; [137] zoo_1.8-12                  jsonlite_1.8.9             </span></span>
<span><span class="co">#&gt; [139] BiocParallel_1.38.0         mclust_6.1.1               </span></span>
<span><span class="co">#&gt; [141] BiocSingular_1.20.0         magrittr_2.0.3             </span></span>
<span><span class="co">#&gt; [143] Formula_1.2-5               scuttle_1.14.0             </span></span>
<span><span class="co">#&gt; [145] GenomeInfoDbData_1.2.12     dotCall64_1.1-1            </span></span>
<span><span class="co">#&gt; [147] patchwork_1.3.0             munsell_0.5.1              </span></span>
<span><span class="co">#&gt; [149] Rcpp_1.0.13                 viridis_0.6.5              </span></span>
<span><span class="co">#&gt; [151] reticulate_1.39.0           furrr_0.3.1                </span></span>
<span><span class="co">#&gt; [153] stringi_1.8.4               zlibbioc_1.50.0            </span></span>
<span><span class="co">#&gt; [155] MASS_7.3-60.2               plyr_1.8.9                 </span></span>
<span><span class="co">#&gt; [157] org.Hs.eg.db_3.19.1         listenv_0.9.1              </span></span>
<span><span class="co">#&gt; [159] ggrepel_0.9.6               deldir_2.0-4               </span></span>
<span><span class="co">#&gt; [161] Biostrings_2.72.1           splines_4.4.1              </span></span>
<span><span class="co">#&gt; [163] tensor_1.5                  hms_1.1.3                  </span></span>
<span><span class="co">#&gt; [165] igraph_2.0.3                ggpubr_0.6.0               </span></span>
<span><span class="co">#&gt; [167] spatstat.geom_3.3-3         ggsignif_0.6.4             </span></span>
<span><span class="co">#&gt; [169] RcppHNSW_0.6.0              reshape2_1.4.4             </span></span>
<span><span class="co">#&gt; [171] biomaRt_2.60.1              stats4_4.4.1               </span></span>
<span><span class="co">#&gt; [173] ScaledMatrix_1.12.0         evaluate_1.0.0             </span></span>
<span><span class="co">#&gt; [175] httpuv_1.6.15               RANN_2.6.2                 </span></span>
<span><span class="co">#&gt; [177] tidyr_1.3.1                 purrr_1.0.2                </span></span>
<span><span class="co">#&gt; [179] polyclip_1.10-7             future_1.34.0              </span></span>
<span><span class="co">#&gt; [181] scattermore_1.2             rsvd_1.0.5                 </span></span>
<span><span class="co">#&gt; [183] broom_1.0.7                 xtable_1.8-4               </span></span>
<span><span class="co">#&gt; [185] RSpectra_0.16-2             rstatix_0.7.2              </span></span>
<span><span class="co">#&gt; [187] later_1.3.2                 viridisLite_0.4.2          </span></span>
<span><span class="co">#&gt; [189] ragg_1.3.3                  tibble_3.2.1               </span></span>
<span><span class="co">#&gt; [191] memoise_2.0.1               beeswarm_0.4.0             </span></span>
<span><span class="co">#&gt; [193] AnnotationDbi_1.68.0        IRanges_2.38.1             </span></span>
<span><span class="co">#&gt; [195] cluster_2.1.6               globals_0.16.3</span></span></code></pre></div>
</details>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Wei Liu, Xiao Zhang, Jin Liu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
